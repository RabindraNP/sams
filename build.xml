<!--
	Master Build for SAMS

	External dependencies:
		- External required libraries for the final SAMS application
		  are located in directory lib/.

	For a complete build:
		ant assembly
-->
<project name="sams" default="compile" >
	<!-- Base dir for generated files.
	     only used here for target clean-dist -->
	<property name="generated" value="out"/>

	<property file="build.properties"/>
	<property name="VERSION" value="3.2.1"/>

	<property name="build" value="${generated}/BUILD"/>
	<property name="dist" value="${generated}/DIST"/>
	<property name="src.dir" value="src"/>
	<property name="dest.dir" value="${build}/classes"/>

	<target name="init">
		<tstamp/>
		<echo message="VERSION = ${VERSION}"/>
		<mkdir dir="${build}/classes"/>
		<delete file="${dest.dir}/info.properties"/>
		<delete file="${dest.dir}/copyright.txt"/>
	</target>

	<target name="compile" depends="init">
		<javac srcdir="${src.dir}" destdir="${dest.dir}"
			   debug="on"
			   deprecation="on"
			   source="1.4"
			   classpath="${plotapplication}:${bsh}"
		/>
	</target>

	<target name="info">
		<copy file="src/info.properties" todir="${dest.dir}"/>
		<replace file="${dest.dir}/info.properties">
			<replacefilter token="@VERSION@" value="${VERSION}"/>
			<replacefilter token="@BUILD@" value="${DSTAMP}"/>
		</replace>
	</target>

	<target name="license">
		<copy file="src/copyright.txt" todir="${dest.dir}"/>
	</target>

	<target name="img">
		<copy todir="${dest.dir}/img">
			<fileset dir="${src.dir}/img"/>
		</copy>
	</target>

	<target name="assembly" depends="compile, info, license, img">
		<property name="dist" value="${generated}/DIST"/>
		<property name="assemblage" value="${dist}/assemblage" />
		<mkdir dir="${assemblage}" />

		<unjar src="lib/bsh-1.3b2.jar"           dest="${assemblage}" />
		<unjar src="lib/kunststoff.jar"          dest="${assemblage}" />
		<unjar src="lib/plotapplication.jar"     dest="${assemblage}" />

		<copy todir="${assemblage}">
			<fileset dir="${dest.dir}" />
		</copy>

		<copy todir="${assemblage}/opers">
			<fileset dir="src/base_dist/opers" />
		</copy>

		<jar jarfile="${dist}/sams-${VERSION}.jar"
			 basedir="${assemblage}"
		>
			<manifest>
				<attribute name="Built-By" value="${user.name}"/>
				<attribute name="Main-class" value="samsgui.Main"/>
			</manifest>
		</jar>
	</target>

	<target name="clean">
		<delete dir="${build}/classes/src"/>
	</target>

	<target name="clean-dist">
		<delete dir="${generated}"/>
	</target>

</project>
